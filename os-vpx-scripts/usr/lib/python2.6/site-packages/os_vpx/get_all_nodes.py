import sys
import xmlrpclib

import XenAPI

from geppetto.geppettolib import puppet


MASTER_URL_PATTERN = 'http://%s:8080/openstack/geppetto/v1'


def get_master_proxy():
    p = puppet.PuppetNode()
    master_fqdn = p.get_puppet_option('server')
    master_url = MASTER_URL_PATTERN % master_fqdn
    return xmlrpclib.ServerProxy(master_url)


def get_nodes():
    proxy = get_master_proxy()
    return proxy.Node.get_details(proxy.Node.get_all())


def get_node_names():
    nodes = get_nodes()
    if len(nodes) < 1:
        print >>sys.stderr, ("Could not find nodes ")
        sys.exit(1)

    rnodes = [name[0] for name in nodes][1:]    
    return ' '.join(rnodes)
