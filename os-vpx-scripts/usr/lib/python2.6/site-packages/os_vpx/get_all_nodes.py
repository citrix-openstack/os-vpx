import sys
import xmlrpclib

import XenAPI

from geppetto.geppettolib.puppet import PuppetNode


MASTER_URL_PATTERN = 'http://%s:8080/openstack/geppetto/v1'


def get_master_proxy():
    master_fqdn = PuppetNode.get_puppet_option('server')
    master_url = MASTER_URL_PATTERN % master_fqdn
    return xmlrpclib.ServerProxy(master_url)


def get_nodes():
    proxy = get_master_proxy()
    return proxy.Node.get_details(proxy.Node.get_all())


def get_node_names():
    proxy = get_master_proxy()
    nodes = proxy.Node.get_all()
    if len(nodes) < 1:
        print >> sys.stderr, ("Could not find nodes ")
        sys.exit(1)

    return ' '.join(nodes[1:])
